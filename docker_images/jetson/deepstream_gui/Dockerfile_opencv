# Install OpenCV with CUDA support
ARG OPENCV_VERSION=4.6.0

WORKDIR /opt

COPY ./packages/opencv.zip ./packages/opencv_contrib.zip /opt/

RUN unzip opencv.zip && rm /opt/opencv.zip && \
    unzip opencv_contrib.zip && rm /opt/opencv_contrib.zip

# Install OpenCV from Source
RUN cd opencv-4.6.0 && \
    mkdir build && \
    cd build && \
    cmake -D CMAKE_BUILD_TYPE=RELEASE \
    -D CMAKE_INSTALL_PREFIX=/usr \
    -D OPENCV_EXTRA_MODULES_PATH=/opt/opencv_contrib-4.6.0/modules \
    -D EIGEN_INCLUDE_PATH=/usr/include/eigen3 \
    -D WITH_OPENCL=OFF \
    -D WITH_CUDA=ON \
    -D CUDA_ARCH_BIN=5.3 \
    -D CUDA_ARCH_PTX="" \
    -D WITH_CUDNN=ON \
    -D WITH_CUBLAS=ON \
    -D ENABLE_FAST_MATH=ON \
    -D CUDA_FAST_MATH=ON \
    -D OPENCV_DNN_CUDA=ON \
    -D ENABLE_NEON=ON \
    -D WITH_QT=OFF \
    -D WITH_OPENMP=ON \
    -D BUILD_TIFF=ON \
    -D WITH_FFMPEG=ON \
    -D WITH_GSTREAMER=ON \
    -D WITH_TBB=ON \
    -D BUILD_TBB=ON \
    -D BUILD_TESTS=OFF \
    -D WITH_EIGEN=ON \
    -D WITH_V4L=ON \
    -D WITH_LIBV4L=ON \
    -D OPENCV_ENABLE_NONFREE=ON \
    -D INSTALL_C_EXAMPLES=OFF \
    -D INSTALL_PYTHON_EXAMPLES=OFF \
    -D PYTHON3_PACKAGES_PATH=/usr/lib/python3/dist-packages \
    -D OPENCV_GENERATE_PKGCONFIG=ON \
    -D BUILD_opencv_world=OFF \
    -D BUILD_EXAMPLES=OFF .. && \
    make -j 2 && \
    make install && \
    #rm -r /usr/include/opencv4/opencv2 && \
    ldconfig && \
    make clean


    Found PythonInterp: /usr/bin/python2.7 (found suitable version "2.7.17", minimum required is "2.7") 
-- Could NOT find PythonLibs (missing: PYTHON_LIBRARIES PYTHON_INCLUDE_DIRS) (Required is exact version "2.7.17")
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: No module named numpy.distutils
-- Found PythonInterp: /usr/bin/python3 (found suitable version "3.6.9", minimum required is "3.2") 
-- Found PythonLibs: /usr/lib/aarch64-linux-gnu/libpython3.6m.so (found suitable exact version "3.6.9") 
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ModuleNotFoundError: No module named 'numpy'

c++: internal compiler error: Killed (program cc1plus)
Please submit a full bug report,
with preprocessed source if appropriate.
See <file:///usr/share/doc/gcc-7/README.Bugs> for instructions.
modules/python3/CMakeFiles/opencv_python3.dir/build.make:62: recipe for target 'modules/python3/CMakeFiles/opencv_python3.dir/__/src2/cv2.cpp.o' failed
make[2]: *** [modules/python3/CMakeFiles/opencv_python3.dir/__/src2/cv2.cpp.o] Error 4
CMakeFiles/Makefile2:9522: recipe for target 'modules/python3/CMakeFiles/opencv_python3.dir/all' failed
make[1]: *** [modules/python3/CMakeFiles/opencv_python3.dir/all] Error 2
Makefile:162: recipe for target 'all' failed
make: *** [all] Error 2
The command '/bin/sh -c cd opencv-${OPENCV_VERSION} &&     mkdir build &&     cd build &&     cmake -D CMAKE_BUILD_TYPE=RELEASE     -D CMAKE_INSTALL_PREFIX=/usr     -D OPENCV_EXTRA_MODULES_PATH=/opt/opencv_contrib-${OPENCV_VERSION}/modules     -D EIGEN_INCLUDE_PATH=/usr/include/eigen3     -D WITH_OPENCL=OFF     -D WITH_CUDA=ON     -D CUDA_ARCH_BIN=5.3     -D CUDA_ARCH_PTX=""     -D WITH_CUDNN=ON     -D WITH_CUBLAS=ON     -D ENABLE_FAST_MATH=ON     -D CUDA_FAST_MATH=ON     -D OPENCV_DNN_CUDA=ON     -D ENABLE_NEON=ON     -D WITH_QT=OFF     -D WITH_OPENMP=ON     -D BUILD_TIFF=ON     -D WITH_FFMPEG=ON     -D WITH_GSTREAMER=ON     -D WITH_TBB=ON     -D BUILD_TBB=ON     -D BUILD_TESTS=OFF     -D WITH_EIGEN=ON     -D WITH_V4L=ON     -D WITH_LIBV4L=ON     -D OPENCV_ENABLE_NONFREE=ON     -D INSTALL_C_EXAMPLES=OFF     -D INSTALL_PYTHON_EXAMPLES=OFF     -D PYTHON3_PACKAGES_PATH=/usr/lib/python3/dist-packages     -D OPENCV_GENERATE_PKGCONFIG=ON     -D BUILD_opencv_world=OFF     -D BUILD_EXAMPLES=OFF .. &&     make -j 2 &&     make install &&     ldconfig &&     make clean' returned a non-zero code: 2


https://stackoverflow.com/questions/37070304/how-to-build-opencv-for-python3-when-both-python2-and-python3-are-installed